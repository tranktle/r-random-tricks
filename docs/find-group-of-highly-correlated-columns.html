<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Section 7 Find group of highly correlated columns | Tran Le _ Random R tricks</title>
<meta name="author" content="Tran Le">
<meta name="description" content="7.1 Introduction Here, we will explore how to find groups of highly correlated columns. Each group contains columns having a correlation higher than a fixed chosen threshold. We will first give a...">
<meta name="generator" content="bookdown 0.30 with bs4_book()">
<meta property="og:title" content="Section 7 Find group of highly correlated columns | Tran Le _ Random R tricks">
<meta property="og:type" content="book">
<meta property="og:description" content="7.1 Introduction Here, we will explore how to find groups of highly correlated columns. Each group contains columns having a correlation higher than a fixed chosen threshold. We will first give a...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Section 7 Find group of highly correlated columns | Tran Le _ Random R tricks">
<meta name="twitter:description" content="7.1 Introduction Here, we will explore how to find groups of highly correlated columns. Each group contains columns having a correlation higher than a fixed chosen threshold. We will first give a...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Tran Le _ Random R tricks</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Introduction</a></li>
<li><a class="" href="github-cheatsheet.html"><span class="header-section-number">2</span> Github-Cheatsheet</a></li>
<li><a class="" href="r-resources-from-absolute-beginners-to-more-advance.html"><span class="header-section-number">3</span> R resources from absolute beginners to more advance</a></li>
<li><a class="" href="problems-when-using-dplyrfull_join.html"><span class="header-section-number">4</span> Problems when using dplyr::full_join</a></li>
<li><a class="" href="load-and-write-to-an-excel-sheet.html"><span class="header-section-number">5</span> Load and write to an excel sheet</a></li>
<li><a class="" href="replace-values-by-nasa-specfic-value.html"><span class="header-section-number">6</span> Replace Values by Nas/A specfic value</a></li>
<li><a class="active" href="find-group-of-highly-correlated-columns.html"><span class="header-section-number">7</span> Find group of highly correlated columns</a></li>
<li><a class="" href="relabel-study-names-into-a-numeric-sequence.html"><span class="header-section-number">8</span> Relabel study names into a numeric sequence</a></li>
<li><a class="" href="arm-base-network-meta-analysis-using-pcnetmeta-package.html"><span class="header-section-number">9</span> Arm base Network Meta Analysis using pcnetmeta package</a></li>
<li><a class="" href="write-many-models-with-shortest-code-using-glue-and-rlang.html"><span class="header-section-number">10</span> Write many models with shortest code using glue and rlang</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/tranktle/r-random-tricks">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="find-group-of-highly-correlated-columns" class="section level1" number="7">
<h1>
<span class="header-section-number">Section 7</span> Find group of highly correlated columns<a class="anchor" aria-label="anchor" href="#find-group-of-highly-correlated-columns"><i class="fas fa-link"></i></a>
</h1>
<div id="introduction-6" class="section level2" number="7.1">
<h2>
<span class="header-section-number">7.1</span> Introduction<a class="anchor" aria-label="anchor" href="#introduction-6"><i class="fas fa-link"></i></a>
</h2>
<p>Here, we will explore how to find groups of highly correlated columns. Each group contains columns having a correlation higher than a fixed chosen threshold.</p>
<p>We will first give a simple data set, then give the code and the result we get. After all, we will explore how the code works. This example based on the question and answer that I got from <a href="https://stackoverflow.com/questions/39482364/group-of-highly-correlated-variables">stackoverflow.com</a>. Some of the functions have been updated since the package is updated at the time I wrote this section (2022).</p>
<p>Besides exploring how to find groups of highly correlated numerical columns, I also do the same with (binary) nominal columns. However, since no command helps compute the correlation matrix with a numerical column, we will need to process this step slightly differently than the above example. This way can be applied if we want to find other kinds of groups of highly correlated variables, such as numeric-numeric and numeric-ordinal,â€¦</p>
</div>
<div id="data-set-and-the-code-to-get-the-result" class="section level2" number="7.2">
<h2>
<span class="header-section-number">7.2</span> Data set and the code to get the result<a class="anchor" aria-label="anchor" href="#data-set-and-the-code-to-get-the-result"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://igraph.org">igraph</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://andrisignorell.github.io/DescTools/">DescTools</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://personality-project.org/r/psych/">psych</a></span><span class="op">)</span><span class="op">)</span>  </span></code></pre></div>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/structure.html">structure</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1L</span>, <span class="fl">2L</span>, <span class="fl">5L</span>, <span class="fl">4L</span>, <span class="fl">366L</span>, <span class="fl">65L</span>, <span class="fl">43L</span>, <span class="fl">456L</span>, <span class="fl">876L</span>, <span class="fl">78L</span>, <span class="fl">687L</span>, <span class="fl">378L</span>, <span class="fl">378L</span>, <span class="fl">34L</span>, <span class="fl">53L</span>, <span class="fl">43L</span><span class="op">)</span>, </span>
<span>                         B <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2L</span>, <span class="fl">2L</span>, <span class="fl">5L</span>, <span class="fl">4L</span>, <span class="fl">366L</span>, <span class="fl">65L</span>, <span class="fl">43L</span>, <span class="fl">456L</span>, <span class="fl">876L</span>, <span class="fl">78L</span>, <span class="fl">687L</span>, <span class="fl">378L</span>, <span class="fl">378L</span>, <span class="fl">34L</span>, <span class="fl">53L</span>, <span class="fl">41L</span><span class="op">)</span>, </span>
<span>                         C <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10L</span>, <span class="fl">20L</span>, <span class="fl">10L</span>, <span class="fl">20L</span>, <span class="fl">10L</span>, <span class="fl">20L</span>, <span class="fl">1L</span>, <span class="fl">0L</span>, <span class="fl">1L</span>, <span class="fl">2010L</span>,<span class="fl">20L</span>, <span class="fl">10L</span>, <span class="fl">10L</span>, <span class="fl">10L</span>, <span class="fl">10L</span>, <span class="fl">10L</span><span class="op">)</span>, </span>
<span>                         D <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2L</span>, <span class="fl">10L</span>, <span class="fl">31L</span>, <span class="fl">2L</span>, <span class="fl">2L</span>, <span class="fl">5L</span>, <span class="fl">2L</span>, <span class="fl">5L</span>, <span class="fl">1L</span>, <span class="fl">52L</span>, <span class="fl">1L</span>, <span class="fl">2L</span>, <span class="fl">52L</span>, <span class="fl">6L</span>, <span class="fl">2L</span>, <span class="fl">1L</span><span class="op">)</span>, </span>
<span>                         E <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4L</span>, <span class="fl">10L</span>, <span class="fl">31L</span>, <span class="fl">2L</span>, <span class="fl">2L</span>, <span class="fl">5L</span>, <span class="fl">2L</span>, <span class="fl">5L</span>, <span class="fl">1L</span>, <span class="fl">52L</span>, <span class="fl">1L</span>, <span class="fl">2L</span>, <span class="fl">52L</span>, <span class="fl">6L</span>, <span class="fl">2L</span>, <span class="fl">3L</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                    .Names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"D"</span>, <span class="st">"E"</span><span class="op">)</span>, </span>
<span>                    class <span class="op">=</span> <span class="st">"data.frame"</span>, row.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="op">-</span><span class="fl">16L</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Here is the code that we can use to get the result</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compute correlation of columns in data1 using pearson</span></span>
<span><span class="va">var.corelation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">data1</span><span class="op">)</span>, method<span class="op">=</span><span class="st">"pearson"</span><span class="op">)</span></span>
<span><span class="co"># prevent duplicated pairs</span></span>
<span><span class="va">var.corelation</span> <span class="op">&lt;-</span> <span class="va">var.corelation</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/lower.tri.html">lower.tri</a></span><span class="op">(</span><span class="va">var.corelation</span><span class="op">)</span></span>
<span><span class="co"># Filter pairs having correlation &gt; threshold</span></span>
<span><span class="va">check.corelation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">var.corelation</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0.62</span>, arr.ind<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">graph.cor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/igraph/man/graph_from_data_frame.html">graph_from_data_frame</a></span><span class="op">(</span><span class="va">check.corelation</span>, directed <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#</span></span>
<span><span class="va">groups.cor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html">split</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span><span class="op">(</span><span class="va">check.corelation</span><span class="op">)</span><span class="op">)</span>,    </span>
<span>                    <span class="fu"><a href="https://rdrr.io/pkg/igraph/man/components.html">clusters</a></span><span class="op">(</span><span class="va">graph.cor</span><span class="op">)</span><span class="op">$</span><span class="va">membership</span><span class="op">)</span></span>
<span><span class="co"># Get the row name of highly correlated groups</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">groups.cor</span>,FUN<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">list.cor</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">var.corelation</span><span class="op">)</span><span class="op">[</span><span class="va">list.cor</span><span class="op">]</span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<pre><code>## $`1`
## [1] "B" "A"
## 
## $`2`
## [1] "D" "E" "C"</code></pre>
<p>If our data has a small number of columns, we can plot groups of highly correlated columns. The below graph gives <strong>indexed</strong> highly correlated clusters.</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">graph.cor</span>, vertex.label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/igraph/man/V.html">V</a></span><span class="op">(</span><span class="va">graph.cor</span><span class="op">)</span><span class="op">$</span><span class="va">name</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-30-1.png" width="672"></div>
</div>
<div id="explain-the-code-in-details" class="section level2" number="7.3">
<h2>
<span class="header-section-number">7.3</span> Explain the code in details<a class="anchor" aria-label="anchor" href="#explain-the-code-in-details"><i class="fas fa-link"></i></a>
</h2>
<p>First, notice that our data only contains numeric columns; we can compute a correlation matrix using Pearson correlation.</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">var.corelation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">data1</span><span class="op">)</span>, method<span class="op">=</span><span class="st">"pearson"</span><span class="op">)</span></span>
<span><span class="va">var.corelation</span></span></code></pre></div>
<pre><code>##            A          B          C          D          E
## A  1.0000000  0.9999978 -0.1385469 -0.1125711 -0.1242381
## B  0.9999978  1.0000000 -0.1384694 -0.1124062 -0.1240949
## C -0.1385469 -0.1384694  1.0000000  0.6212136  0.6220380
## D -0.1125711 -0.1124062  0.6212136  1.0000000  0.9992690
## E -0.1242381 -0.1240949  0.6220380  0.9992690  1.0000000</code></pre>
<p>Since the correlation matrix is symmetric through the diagonal and the values on the diagonal are equal to 1, we just need to keep the values in the lower diagonal.</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/lower.tri.html">lower.tri</a></span><span class="op">(</span><span class="va">var.corelation</span><span class="op">)</span></span></code></pre></div>
<pre><code>##       [,1]  [,2]  [,3]  [,4]  [,5]
## [1,] FALSE FALSE FALSE FALSE FALSE
## [2,]  TRUE FALSE FALSE FALSE FALSE
## [3,]  TRUE  TRUE FALSE FALSE FALSE
## [4,]  TRUE  TRUE  TRUE FALSE FALSE
## [5,]  TRUE  TRUE  TRUE  TRUE FALSE</code></pre>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">var.corelation</span> <span class="op">&lt;-</span> <span class="va">var.corelation</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/lower.tri.html">lower.tri</a></span><span class="op">(</span><span class="va">var.corelation</span><span class="op">)</span><span class="op">-</span></span>
<span><span class="va">var.corelation</span></span></code></pre></div>
<p>With this example, we only filter columns with a correlation &gt; 0.62. The result below shows us the location row and columns of highly correlated pairs. For example, The first one is (row 2, column 1) associated with (B, A) is a pair of columns having correlation &gt; threshold, etc.</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">threshold</span> <span class="op">=</span> <span class="fl">0.62</span></span>
<span><span class="va">check_corelation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">var.corelation</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0.62</span>, arr.ind<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">check_corelation</span></span></code></pre></div>
<pre><code>##   row col
## A   1   1
## A   1   2
## B   2   2
## C   3   3
## C   3   4
## D   4   4
## C   3   5
## D   4   5
## E   5   5</code></pre>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">graph.cor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/igraph/man/graph_from_data_frame.html">graph_from_data_frame</a></span><span class="op">(</span><span class="va">check.corelation</span>, directed <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">graph.cor</span></span></code></pre></div>
<pre><code>## IGRAPH 2cf17b9 UN-- 5 4 -- 
## + attr: name (v/c)
## + edges from 2cf17b9 (vertex names):
## [1] 2--1 4--3 5--3 4--5</code></pre>
<p>Now, we will consider the clustersâ€™ membership used to split our data. From the membership, the first row is the indexes of columns, and the second row is the index of the cluster that those columns belong to. We see that column with indexes 2 and 1 (columns B and A) is in cluster 1, and columns with indexes 4, 5, and 3 (columns D, E, and C) are in cluster 2.</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/components.html">components</a></span><span class="op">(</span><span class="va">graph.cor</span><span class="op">)</span></span></code></pre></div>
<pre><code>## $membership
## 2 4 5 1 3 
## 1 2 2 1 2 
## 
## $csize
## [1] 2 3
## 
## $no
## [1] 2</code></pre>
<p>So, now we split the column indexes into cluster</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span><span class="op">(</span><span class="va">check.corelation</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] 2 4 5 1 3</code></pre>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">groups.cor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html">split</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span><span class="op">(</span><span class="va">check.corelation</span><span class="op">)</span><span class="op">)</span>,  </span>
<span>                    <span class="fu"><a href="https://rdrr.io/pkg/igraph/man/components.html">components</a></span><span class="op">(</span><span class="va">graph.cor</span><span class="op">)</span><span class="op">$</span><span class="va">membership</span><span class="op">)</span></span>
<span><span class="va">groups.cor</span></span></code></pre></div>
<pre><code>## $`1`
## [1] 2 1
## 
## $`2`
## [1] 4 5 3</code></pre>
<p>And get the column names of the columns in each cluster.</p>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">groups.cor</span>,FUN<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">list.cor</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">var.corelation</span><span class="op">)</span><span class="op">[</span><span class="va">list.cor</span><span class="op">]</span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<pre><code>## $`1`
## [1] "B" "A"
## 
## $`2`
## [1] "D" "E" "C"</code></pre>
</div>
<div id="deal-with-nominal-nominal-variables" class="section level2" number="7.4">
<h2>
<span class="header-section-number">7.4</span> Deal with nominal-nominal variables<a class="anchor" aria-label="anchor" href="#deal-with-nominal-nominal-variables"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">365263</span><span class="op">)</span></span>
<span><span class="va">X1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">16</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">X2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"E"</span>, <span class="st">"H"</span> <span class="op">)</span>, size <span class="op">=</span> <span class="fl">16</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">X3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"X"</span>, <span class="st">"Y"</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">16</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">X4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"L"</span>, <span class="st">"M"</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">16</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">X5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"K"</span>, <span class="st">"L"</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">16</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">data2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span><span class="va">X1</span>, <span class="va">X2</span>, <span class="va">X3</span>, <span class="va">X4</span>, <span class="va">X5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">data2</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 6 Ã— 5
##   X1    X2    X3    X4    X5   
##   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
## 1 B     H     X     M     L    
## 2 B     H     Y     M     K    
## 3 A     H     Y     L     L    
## 4 B     E     Y     L     L    
## 5 B     E     Y     L     L    
## 6 B     H     X     M     L</code></pre>
</div>
<div id="here-is-the-code-to-get-group-of-highly-correlated-columns" class="section level2" number="7.5">
<h2>
<span class="header-section-number">7.5</span> Here is the code to get group of highly correlated columns<a class="anchor" aria-label="anchor" href="#here-is-the-code-to-get-group-of-highly-correlated-columns"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">colname</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">data2</span><span class="op">)</span></span>
<span><span class="va">pair_cols</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/combn.html">combn</a></span><span class="op">(</span><span class="va">colname</span>, <span class="fl">2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="va">t</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Warning: The `x` argument of `as_tibble.matrix()` must have unique column names if `.name_repair` is omitted as of tibble 2.0.0.
## Using compatibility `.name_repair`.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was generated.</code></pre>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">com_phi_f</span> <span class="op">&lt;-</span><span class="kw">function</span><span class="op">(</span><span class="va">var1</span>, <span class="va">var2</span><span class="op">)</span><span class="op">{</span><span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/psych/man/phi.html">phi</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">var1</span>, <span class="va">var2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">}</span></span>
<span><span class="co"># Create a vector that contain phi corr(V1, V2) for all of pairs</span></span>
<span><span class="va">nom_cor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">pair_cols</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co"># get the values of the variable associated with variable </span></span>
<span>  <span class="co">#pair_cols$V1[row==i] and pair_cols$V2[row==i]</span></span>
<span>  <span class="va">var1</span> <span class="op">&lt;-</span> <span class="va">data2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html">all_of</a></span><span class="op">(</span><span class="va">pair_cols</span><span class="op">$</span><span class="va">V1</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="va">pull</span></span>
<span>  <span class="va">var2</span> <span class="op">&lt;-</span> <span class="va">data2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html">all_of</a></span><span class="op">(</span><span class="va">pair_cols</span><span class="op">$</span><span class="va">V2</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="va">pull</span></span>
<span>  <span class="va">nom_cor</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="fu">com_phi_f</span><span class="op">(</span><span class="va">var1</span>, <span class="va">var2</span><span class="op">)</span><span class="op">}</span></span>
<span><span class="co"># Combine the nom_cor (corrlation value column) to the pair_cols data frame</span></span>
<span><span class="va">pair_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">pair_cols</span>, <span class="va">nom_cor</span><span class="op">)</span> </span>
<span><span class="co"># Filter pairs having corrleation &gt;= threshold</span></span>
<span><span class="va">threshold</span> <span class="op">=</span> <span class="fl">0.20</span></span>
<span><span class="va">pair_cols</span> <span class="op">&lt;-</span> <span class="va">pair_cols</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">nom_cor</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="va">threshold</span><span class="op">)</span></span>
<span><span class="co"># Connect the var_name of pairs having corr &gt; threshold</span></span>
<span><span class="va">high_cor_pair</span> <span class="op">&lt;-</span> <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/graph_from_data_frame.html">graph_from_data_frame</a></span><span class="op">(</span><span class="va">pair_cols</span>, directed <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># </span></span>
<span><span class="va">col_cluster</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/igraph/man/components.html">clusters</a></span><span class="op">(</span><span class="va">high_cor_pair</span><span class="op">)</span></span>
<span><span class="co"># Create a table include cluster_index and var_name</span></span>
<span><span class="va">group_var_dat</span> <span class="op">&lt;-</span> <span class="va">col_cluster</span><span class="op">$</span><span class="va">membership</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span><span class="op">(</span><span class="st">"var_name"</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>group_index <span class="op">=</span> <span class="st">"."</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">group_index</span>, <span class="va">var_name</span><span class="op">)</span></span>
<span><span class="co"># Split the var_name based on cluster index</span></span>
<span><span class="co"># Each cluster contains cluster index and variable (column) names</span></span>
<span><span class="co"># of highly correlated columns in the cluster</span></span>
<span><span class="va">my_cluster</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html">split</a></span><span class="op">(</span><span class="va">group_var_dat</span>, f<span class="op">=</span><span class="va">group_var_dat</span><span class="op">$</span><span class="va">group_index</span><span class="op">)</span></span>
<span><span class="va">my_cluster</span></span></code></pre></div>
<pre><code>## $`1`
##   group_index var_name
## 1           1       X1
## 4           1       X5
## 
## $`2`
##   group_index var_name
## 2           2       X2
## 3           2       X3
## 5           2       X4</code></pre>
<p>&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD
The below code chunk gives you tables of group indexes and names of variables in each group. In case you want to combine the result, which means you want to create a table with the names of variables in each group in one row, then you can do this:</p>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create nested tables depending on group index</span></span>
<span><span class="va">nest_data</span> <span class="op">&lt;-</span> <span class="va">group_var_dat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">group_index</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">nest</a></span><span class="op">(</span><span class="op">)</span> </span>
<span><span class="co"># Create a table that that take names (values) in each nested tibble and paste them together</span></span>
<span><span class="va">my_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span>ncol<span class="op">=</span><span class="fl">1</span>,nrow<span class="op">=</span><span class="fl">0</span>, dimnames<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="cn">NULL</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"high_corrected_var"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">nest_data</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">high_correted_var</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c</a></span><span class="op">(</span><span class="va">nest_data</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span>use.names <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>, collapse<span class="op">=</span><span class="st">", "</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">my_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">my_table</span>, <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">high_correted_var</span><span class="op">)</span><span class="op">)</span><span class="op">}</span></span></code></pre></div>
<p>Now you have a table with just one column, each row contains names of columns in each highly-correlated-columns cluster.</p>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_table</span></span></code></pre></div>
<pre><code>##   high_correted_var
## 1            X1, X5
## 2        X2, X3, X4</code></pre>
<p>=======</p>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<p>56eeb42d87bc29311ec57c37bae5be9a4b59edac</p>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</div>
<div id="explain-the-steps-in-details" class="section level2" number="7.6">
<h2>
<span class="header-section-number">7.6</span> Explain the steps in details<a class="anchor" aria-label="anchor" href="#explain-the-steps-in-details"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">colname</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">data2</span><span class="op">)</span></span>
<span><span class="va">pair_cols</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/combn.html">combn</a></span><span class="op">(</span><span class="va">colname</span>, <span class="fl">2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="va">t</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">pair_cols</span></span></code></pre></div>
<pre><code>## # A tibble: 10 Ã— 2
##    V1    V2   
##    &lt;chr&gt; &lt;chr&gt;
##  1 X1    X2   
##  2 X1    X3   
##  3 X1    X4   
##  4 X1    X5   
##  5 X2    X3   
##  6 X2    X4   
##  7 X2    X5   
##  8 X3    X4   
##  9 X3    X5   
## 10 X4    X5</code></pre>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">com_phi_f</span> <span class="op">&lt;-</span><span class="kw">function</span><span class="op">(</span><span class="va">var1</span>, <span class="va">var2</span><span class="op">)</span><span class="op">{</span><span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/psych/man/phi.html">phi</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">var1</span>, <span class="va">var2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a vector that contain phi corr(V1, V2) for all of pairs</span></span>
<span><span class="va">nom_cor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">pair_cols</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="co"># get the values of the variable associated with variable </span></span>
<span>    <span class="co">#pair_cols$V1[row==i] and pair_cols$V2[row==i]</span></span>
<span>  <span class="va">var1</span> <span class="op">&lt;-</span> <span class="va">data2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html">all_of</a></span><span class="op">(</span><span class="va">pair_cols</span><span class="op">$</span><span class="va">V1</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="va">pull</span></span>
<span>  <span class="va">var2</span> <span class="op">&lt;-</span> <span class="va">data2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html">all_of</a></span><span class="op">(</span><span class="va">pair_cols</span><span class="op">$</span><span class="va">V2</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="va">pull</span></span>
<span>  <span class="va">nom_cor</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="fu">com_phi_f</span><span class="op">(</span><span class="va">var1</span>, <span class="va">var2</span><span class="op">)</span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pair_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">pair_cols</span>, <span class="va">nom_cor</span><span class="op">)</span> </span></code></pre></div>
<p>For doing the example, just choose a really small threshold = 0.20</p>
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">threshold</span> <span class="op">=</span> <span class="fl">0.20</span></span>
<span><span class="va">pair_cols</span> <span class="op">&lt;-</span> <span class="va">pair_cols</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">nom_cor</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="va">threshold</span><span class="op">)</span></span>
<span><span class="va">pair_cols</span></span></code></pre></div>
<pre><code>##   V1 V2 nom_cor
## 1 X1 X5    0.22
## 2 X2 X3    0.20
## 3 X3 X4   -0.26</code></pre>
<p>Now, we can create a list of highly correlated pairs using <a href="https://igraph.org/r/doc/graph_from_data_frame.html">graph_from_data_frame</a></p>
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">high_cor_pair</span> <span class="op">&lt;-</span> <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/graph_from_data_frame.html">graph_from_data_frame</a></span><span class="op">(</span><span class="va">pair_cols</span>, directed <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">high_cor_pair</span></span></code></pre></div>
<pre><code>## IGRAPH 2d4474c UN-- 5 3 -- 
## + attr: name (v/c), nom_cor (e/n)
## + edges from 2d4474c (vertex names):
## [1] X1--X5 X2--X3 X3--X4</code></pre>
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">col_cluster</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/igraph/man/components.html">clusters</a></span><span class="op">(</span><span class="va">high_cor_pair</span><span class="op">)</span></span>
<span><span class="va">col_cluster</span></span></code></pre></div>
<pre><code>## $membership
## X1 X2 X3 X5 X4 
##  1  2  2  1  2 
## 
## $csize
## [1] 2 3
## 
## $no
## [1] 2</code></pre>
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">group_var_dat</span> <span class="op">&lt;-</span> <span class="va">col_cluster</span><span class="op">$</span><span class="va">membership</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span><span class="op">(</span><span class="st">"var_name"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>group_index <span class="op">=</span> <span class="st">"."</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">group_index</span>, <span class="va">var_name</span><span class="op">)</span></span>
<span><span class="va">group_var_dat</span></span></code></pre></div>
<pre><code>##   group_index var_name
## 1           1       X1
## 2           2       X2
## 3           2       X3
## 4           1       X5
## 5           2       X4</code></pre>
<div class="sourceCode" id="cb93"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_cluster</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html">split</a></span><span class="op">(</span><span class="va">group_var_dat</span>, f<span class="op">=</span><span class="va">group_var_dat</span><span class="op">$</span><span class="va">group_index</span><span class="op">)</span></span>
<span><span class="va">my_cluster</span></span></code></pre></div>
<pre><code>## $`1`
##   group_index var_name
## 1           1       X1
## 4           1       X5
## 
## $`2`
##   group_index var_name
## 2           2       X2
## 3           2       X3
## 5           2       X4</code></pre>
<p>&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD
## References
=======
# References
&gt;&gt;&gt;&gt;&gt;&gt;&gt; 56eeb42d87bc29311ec57c37bae5be9a4b59edac</p>
<p>[(<a href="https://stackoverflow.com/questions/39482364/group-of-highly-correlated-variables" class="uri">https://stackoverflow.com/questions/39482364/group-of-highly-correlated-variables</a>]((<a href="https://stackoverflow.com/questions/39482364/group-of-highly-correlated-variables" class="uri">https://stackoverflow.com/questions/39482364/group-of-highly-correlated-variables</a>)<br><a href="https://igraph.org/">igraph - The network analysis package - webpage</a></p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="replace-values-by-nasa-specfic-value.html"><span class="header-section-number">6</span> Replace Values by Nas/A specfic value</a></div>
<div class="next"><a href="relabel-study-names-into-a-numeric-sequence.html"><span class="header-section-number">8</span> Relabel study names into a numeric sequence</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#find-group-of-highly-correlated-columns"><span class="header-section-number">7</span> Find group of highly correlated columns</a></li>
<li><a class="nav-link" href="#introduction-6"><span class="header-section-number">7.1</span> Introduction</a></li>
<li><a class="nav-link" href="#data-set-and-the-code-to-get-the-result"><span class="header-section-number">7.2</span> Data set and the code to get the result</a></li>
<li><a class="nav-link" href="#explain-the-code-in-details"><span class="header-section-number">7.3</span> Explain the code in details</a></li>
<li><a class="nav-link" href="#deal-with-nominal-nominal-variables"><span class="header-section-number">7.4</span> Deal with nominal-nominal variables</a></li>
<li><a class="nav-link" href="#here-is-the-code-to-get-group-of-highly-correlated-columns"><span class="header-section-number">7.5</span> Here is the code to get group of highly correlated columns</a></li>
<li><a class="nav-link" href="#explain-the-steps-in-details"><span class="header-section-number">7.6</span> Explain the steps in details</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/tranktle/r-random-tricks/blob/master/06_Find_Group_Of_Highly_Correlated_Column.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/tranktle/r-random-tricks/edit/master/06_Find_Group_Of_Highly_Correlated_Column.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Tran Le _ Random R tricks</strong>" was written by Tran Le. It was last built on 04-01-2022 Updated:2022-12-07.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
