# Relabel study names into a numeric sequence 

## Introduction

I have read a tutorial about how to use [Bayesian network meta analysis](https://cran.r-project.org/web/packages/bnma/vignettes/my-vignette.html). In that, to use the package, I have to **relabel study names into a numeric sequence**. 

So, this is the idea of the data that I want: 

```{r, warning=FALSE}
suppressPackageStartupMessages(library(tidyverse))
```


```{r, echo=FALSE}
Study <- c("E", "E", "A", "A", "B", "B", "B", "C", "D", "D")
Study_num_id <- c(1L, 1L, 2L, 2L, 2L, 3L, 4L, 4L, 5L, 5L)
data <- tibble(Study, Study_num_id)
data
```
## Create data


```{r}
Study <- c("E", "E", "A", "A", "B", "B", "B", "C", "D", "D" )
data <- tibble(Study)
data <- data %>% arrange(Study) # THIS STEP IS ESSENTIAL
```
```{r}
n_occur <- data.frame(table(data$Study))
n_occur
```

```{r}
Stu_num_id <- c()
for (i in 1:dim(n_occur)[1]){
    num_id <- rep(i, times = n_occur$Freq[i])
    Stu_num_id <- Stu_num_id %>% append(num_id)
}
```

Note: ***To make the study is appear correctly, you will need to arrange your studies based on alphabet order***
```{r}
data <- data %>% cbind(Stu_num_id)
data
```
### What if we want to keep the order of Study names as they were

```{r}
Study <- c("E", "E", "A", "A", "B", "B", "B", "C", "D", "D")
Study_num_id <- c(1L, 1L, 2L, 2L, 2L, 3L, 4L, 4L, 5L, 5L)
data <- tibble(Study, Study_num_id)
data
```
```{r}
data <- data %>% select(-c("Study_num_id"))
```

```{r}
n_occur <- data.frame(table(data$Study))
n_occur
```

I don't think this is a clever way of doing this (especially with data having many studies). 

```{r}
Study_name_unique <- data %$% Study %>% unique()
Study_name_unique
```


```{r}
Study <- c()
Stu_num_id <- c()
for (i in 1:dim(n_occur)[1]){
    study <- rep(Study_name_unique[i], times= n_occur$Freq[i])
    Study <- Study %>% append(study)
    num_id <- rep(i, times = n_occur$Freq[i])
    Stu_num_id <- Stu_num_id %>% append(num_id)
}
Study_Studyid_dat <- tibble(Study, Stu_num_id)
Study_Studyid_dat
```
Now, we have a table with Study name and Study id with the original of Study name oder. If we have your original data with many more columns, what we need to do is just joining the two data tables. 

## Transform an arm-based data table to a study-based data table
```{r}
Treat <- c("T", "P", "P", "T", "O", "T", "T", "P", "P", "T")

N <- c(12, 23, 45, 78, 12, 2 , 4, 6, 8, 9)
Total <- c(222, 344, 222, 445, 224, 677, 345, 446, 234, 467) 
data <- data %>% cbind(Treat) %>% cbind(N) %>% cbind(Total)%>% mutate(Treat = factor(Treat))
```
```{r}
data
```
```{r, warning=FALSE}
data %>% pivot_wider(names_from = Treat, values_from = c(N,Total))
```


## Frequentist Network meta analysis

Reference: [https://bookdown.org/MathiasHarrer/Doing_Meta_Analysis_in_R/netwma.html](https://bookdown.org/MathiasHarrer/Doing_Meta_Analysis_in_R/netwma.html)

```{r}
suppressPackageStartupMessages(library(dmetar))
```

```{r}
DT::datatable(TherapyFormats)
```
```{r}
str(TherapyFormats)
```

```{r}
TherapyFormats$treat1 %>% unique() 
```

```{r}
TherapyFormats %$% treat2 %>% unique() 
```

## Arm base Network Meta Analysis using pcnetmeta package 

Reference: [https://pubmed.ncbi.nlm.nih.gov/28883783/](https://pubmed.ncbi.nlm.nih.gov/28883783/)

```{r, warning=FALSE}
suppressPackageStartupMessages(library("pcnetmeta"))
data("smoke")
```
- The columns:
    - s.id: contains IDs for the 24 studies, \
    - t.id: labels the treatments included in each study \
    - r: the number of events \
    - n: the number of participants, respectively \

```{r}
head(smoke)
```

```{r}
nma.networkplot(s.id, t.id, data = smoke, trtname = c("NC", "SH", "IC", "GC"))
```

## References
- [Doing Meta-Analysis in R: A Hands-on Guide: Network Meta-Analysis](https://bookdown.org/MathiasHarrer/Doing_Meta_Analysis_in_R/netwma.html)
- [Performing Arm-Based Network Meta-Analysis in R with the pcnetmeta Package](https://pubmed.ncbi.nlm.nih.gov/28883783/)






